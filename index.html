<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Premios BICE 2025 - Encuesta</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #1e5a8e 0%, #2980b9 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.2);
            overflow: hidden;
        }

        .tabs {
            display: flex;
            background: #f8f9fa;
            border-bottom: 2px solid #dee2e6;
        }

        .tab {
            flex: 1;
            padding: 20px;
            text-align: center;
            cursor: pointer;
            font-weight: 600;
            color: #495057;
            transition: all 0.3s;
            border-bottom: 3px solid transparent;
        }

        .tab:hover {
            background: #e9ecef;
        }

        .tab.active {
            color: #2980b9;
            border-bottom-color: #2980b9;
            background: white;
        }

        .tab-content {
            display: none;
            padding: 30px;
            animation: fadeIn 0.5s;
        }

        .tab-content.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
            padding: 20px;
            background: linear-gradient(135deg, #1e5a8e 0%, #2980b9 100%);
            color: white;
            border-radius: 10px;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
        }

        .header p {
            font-size: 1.1em;
            opacity: 0.9;
        }

        .form-group {
            margin-bottom: 25px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #2c3e50;
            font-size: 1.1em;
        }

        .form-group input,
        .form-group select {
            width: 100%;
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 1em;
            transition: border-color 0.3s;
        }

        .form-group input:focus,
        .form-group select:focus {
            outline: none;
            border-color: #2980b9;
        }

        .question-container {
            display: none;
            animation: slideIn 0.5s;
        }

        .question-container.active {
            display: block;
        }

        @keyframes slideIn {
            from { opacity: 0; transform: translateX(20px); }
            to { opacity: 1; transform: translateX(0); }
        }

        .question-title {
            font-size: 1.8em;
            color: #2c3e50;
            margin-bottom: 20px;
            padding: 15px;
            background: #f8f9fa;
            border-left: 5px solid #2980b9;
            border-radius: 5px;
        }

        .filters {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .filter-btn {
            padding: 10px 20px;
            border: 2px solid #2980b9;
            background: white;
            color: #2980b9;
            border-radius: 25px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s;
        }

        .filter-btn:hover {
            background: #2980b9;
            color: white;
            transform: translateY(-2px);
        }

        .filter-btn.active {
            background: #2980b9;
            color: white;
        }

        .candidates-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 15px;
            margin-bottom: 30px;
            max-height: 500px;
            overflow-y: auto;
            padding: 10px;
        }

        .candidate-card {
            padding: 20px;
            border: 2px solid #e9ecef;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s;
            background: white;
        }

        .candidate-card:hover {
            border-color: #2980b9;
            transform: translateY(-5px);
            box-shadow: 0 5px 15px rgba(41, 128, 185, 0.2);
        }

        .candidate-card.selected {
            background: #2980b9;
            color: white;
            border-color: #2980b9;
        }

        .candidate-name {
            font-weight: 600;
            font-size: 1.1em;
            margin-bottom: 5px;
        }

        .candidate-team {
            font-size: 0.9em;
            opacity: 0.8;
        }

        .navigation {
            display: flex;
            gap: 15px;
            margin-top: 30px;
            justify-content: space-between;
        }

        .btn {
            padding: 12px 30px;
            border: none;
            border-radius: 8px;
            font-size: 1em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }

        .btn-primary {
            background: #2980b9;
            color: white;
        }

        .btn-primary:hover {
            background: #1e5a8e;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(41, 128, 185, 0.3);
        }

        .btn-secondary {
            background: #6c757d;
            color: white;
        }

        .btn-secondary:hover {
            background: #5a6268;
        }

        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .progress-bar {
            width: 100%;
            height: 10px;
            background: #e9ecef;
            border-radius: 10px;
            margin-bottom: 30px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: #2980b9;
            transition: width 0.3s;
        }

        .admin-login {
            max-width: 400px;
            margin: 50px auto;
            text-align: center;
        }

        .admin-dashboard {
            display: none;
        }

        .admin-dashboard.active {
            display: block;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            border-left: 5px solid #2980b9;
        }

        .stat-card h3 {
            color: #2c3e50;
            margin-bottom: 15px;
            font-size: 1.2em;
        }

        .result-item {
            display: flex;
            justify-content: space-between;
            padding: 10px;
            margin: 5px 0;
            background: white;
            border-radius: 5px;
        }

        .result-name {
            font-weight: 600;
        }

        .result-votes {
            color: #2980b9;
            font-weight: 600;
        }

        .export-buttons {
            display: flex;
            gap: 15px;
            margin-bottom: 30px;
        }

        .success-message {
            display: none;
            padding: 20px;
            background: #d4edda;
            color: #155724;
            border-radius: 10px;
            margin-bottom: 20px;
            text-align: center;
        }

        .success-message.show {
            display: block;
            animation: fadeIn 0.5s;
        }

        .search-box {
            width: 100%;
            padding: 12px;
            margin-bottom: 20px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 1em;
        }

        .search-box:focus {
            outline: none;
            border-color: #2980b9;
        }

        @media (max-width: 768px) {
            .candidates-grid {
                grid-template-columns: 1fr;
            }

            .filters {
                flex-direction: column;
            }

            .navigation {
                flex-direction: column;
            }

            .header h1 {
                font-size: 1.8em;
            }
        }

        .gender-badge {
            display: inline-block;
            padding: 3px 8px;
            border-radius: 12px;
            font-size: 0.8em;
            margin-left: 5px;
        }

        .gender-male {
            background: #cfe2ff;
            color: #084298;
        }

        .gender-female {
            background: #f8d7da;
            color: #842029;
        }

        .chart-container {
            margin: 20px 0;
            padding: 20px;
            background: white;
            border-radius: 10px;
        }

        .bar-chart {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .bar-item {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .bar-label {
            min-width: 150px;
            font-weight: 600;
        }

        .bar-fill-container {
            flex: 1;
            height: 30px;
            background: #e9ecef;
            border-radius: 5px;
            overflow: hidden;
            position: relative;
        }

        .bar-fill {
            height: 100%;
            background: linear-gradient(90deg, #2980b9, #3498db);
            transition: width 0.5s ease;
            display: flex;
            align-items: center;
            justify-content: flex-end;
            padding-right: 10px;
            color: white;
            font-weight: 600;
        }

        .stats-summary {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .summary-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 25px;
            border-radius: 15px;
            text-align: center;
        }

        .summary-number {
            font-size: 3em;
            font-weight: bold;
            margin-bottom: 10px;
        }

        .summary-label {
            font-size: 1.1em;
            opacity: 0.9;
        }

        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.7);
            z-index: 10000;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .modal-content {
            background: white;
            border-radius: 15px;
            padding: 30px;
            max-width: 900px;
            width: 100%;
            max-height: 80vh;
            overflow-y: auto;
        }

        table {
            width: 100%;
            border-collapse: collapse;
        }

        thead {
            background: #f8f9fa;
            position: sticky;
            top: 0;
        }

        th, td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #e9ecef;
        }

        th {
            font-weight: 600;
            color: #2c3e50;
        }

        tr:hover {
            background: #f8f9fa;
        }

        .btn-danger {
            background: #e74c3c;
            color: white;
        }

        .btn-danger:hover {
            background: #c0392b;
        }

        #responsesTable {
            font-size: 0.95em;
        }

        #responsesTable td {
            vertical-align: middle;
        }

        .warning-box {
            padding: 15px;
            background: #fff3cd;
            border: 2px solid #ffc107;
            border-radius: 10px;
            color: #856404;
            margin: 15px 0;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="tabs">
            <div class="tab active" onclick="switchTab('encuesta')">
                üìã Encuesta
            </div>
            <div class="tab" onclick="switchTab('admin')">
                üîê Administrador
            </div>
        </div>

        <!-- PESTA√ëA ENCUESTA -->
        <div id="encuesta" class="tab-content active">
            <div class="header">
                <h1>üèÜ Premios BICE 2025</h1>
                <p>Vota por tus compa√±eros destacados del a√±o</p>
            </div>

            <div id="successMessage" class="success-message">
                ‚úÖ ¬°Tu voto ha sido registrado exitosamente! Gracias por participar.
            </div>

            <!-- Informaci√≥n Personal -->
            <div id="personalInfo" class="question-container active">
                <h2 class="question-title">Informaci√≥n Personal</h2>
                
                <div style="background: #e3f2fd; padding: 20px; border-radius: 10px; margin-bottom: 25px; border-left: 5px solid #2980b9;">
                    <h3 style="color: #2980b9; margin-bottom: 10px; font-size: 1.3em;">üìù Selecciona tu nombre para iniciar la encuesta</h3>
                    <p style="color: #555; margin: 0;">Busca tu nombre en la lista a continuaci√≥n usando los filtros o la barra de b√∫squeda.</p>
                </div>
                
                <input type="text" class="search-box" id="personalSearch" placeholder="üîç Buscar tu nombre..." onkeyup="filterPersonalCandidates()">
                
                <div style="margin-bottom: 15px;">
                    <strong>Filtros:</strong>
                    <div id="personal-active-filters" style="margin-top: 10px; min-height: 20px;"></div>
                </div>
                
                <div class="filters">
                    <button class="filter-btn" onclick="togglePersonalFilter('M', 'gender')">üë® Hombres</button>
                    <button class="filter-btn" onclick="togglePersonalFilter('F', 'gender')">üë© Mujeres</button>
                    <button class="filter-btn" onclick="togglePersonalFilter('AGF BICE', 'team')">AGF BICE</button>
                    <button class="filter-btn" onclick="togglePersonalFilter('AGF Security', 'team')">AGF Security</button>
                    <button class="filter-btn" onclick="togglePersonalFilter('Estudios BICE', 'team')">Estudios BICE</button>
                    <button class="filter-btn" onclick="togglePersonalFilter('Estudios Security', 'team')">Estudios Security</button>
                    <button class="filter-btn" onclick="togglePersonalFilter('Practicante BICE', 'team')">Practicante BICE</button>
                    <button class="btn btn-secondary" style="padding: 5px 15px; margin-left: 10px;" onclick="clearPersonalFilters()">Limpiar filtros</button>
                </div>
                
                <div class="form-group">
                    <label>Selecciona tu nombre de la lista: *</label>
                    <div class="candidates-grid" id="personal-candidates" style="max-height: 400px;">
                        <!-- Los candidatos se cargar√°n aqu√≠ din√°micamente -->
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="email">Correo Electr√≥nico *</label>
                    <input type="email" id="email" required placeholder="tu.correo@ejemplo.com">
                </div>
                
                <div id="duplicateWarning" style="display: none; padding: 15px; background: #fff3cd; border: 2px solid #ffc107; border-radius: 10px; margin: 15px 0; color: #856404;">
                    <strong>‚ö†Ô∏è Atenci√≥n:</strong> Ya existe una respuesta registrada con este correo electr√≥nico. No puedes votar nuevamente.
                </div>
                
                <div class="navigation">
                    <div></div>
                    <button class="btn btn-primary" onclick="startSurvey()">Comenzar Encuesta ‚Üí</button>
                </div>
            </div>

            <!-- Preguntas de la Encuesta -->
            <div id="surveyQuestions" style="display: none;">
                <div class="progress-bar">
                    <div id="progressFill" class="progress-fill" style="width: 0%"></div>
                </div>

                <!-- Las preguntas se generar√°n din√°micamente aqu√≠ -->
            </div>
        </div>

        <!-- PESTA√ëA ADMINISTRADOR -->
        <div id="admin" class="tab-content">
            <div class="admin-login" id="adminLogin">
                <div class="header">
                    <h2>üîê Acceso Administrador</h2>
                </div>
                <div class="form-group">
                    <label for="adminPassword">Contrase√±a</label>
                    <input type="password" id="adminPassword" placeholder="Ingrese la contrase√±a">
                </div>
                <button class="btn btn-primary" onclick="checkAdminPassword()">Ingresar</button>
            </div>

            <div class="admin-dashboard" id="adminDashboard">
                <div class="header">
                    <h2>üìä Panel de Administraci√≥n</h2>
                    <p>Resultados en tiempo real</p>
                </div>

                <div class="export-buttons">
                    <button class="btn btn-primary" onclick="exportToExcel()">üì• Exportar a Excel</button>
                    <button class="btn btn-primary" onclick="generatePDF()">üìÑ Generar PDF</button>
                    <button class="btn btn-primary" onclick="manageResponses()" style="background: #e74c3c;">üóëÔ∏è Gestionar Respuestas</button>
                    <button class="btn btn-secondary" onclick="logout()">üö™ Cerrar Sesi√≥n</button>
                </div>

                <div id="statsContainer" class="stats-grid">
                    <!-- Las estad√≠sticas se generar√°n din√°micamente aqu√≠ -->
                </div>
            </div>
        </div>
    </div>

    <script>
        // Datos de candidatos
        const candidates = [
            // AGF BICE
            { nombre: "Pedro", apellido: "Abogabir", equipo: "AGF BICE", genero: "M" },
            { nombre: "Soledad", apellido: "Acoroni", equipo: "AGF BICE", genero: "F" },
            { nombre: "Jaime", apellido: "Albandoz", equipo: "AGF BICE", genero: "M" },
            { nombre: "Daniel", apellido: "Beltran", equipo: "AGF BICE", genero: "M" },
            { nombre: "Javiera", apellido: "Brice√±o", equipo: "AGF BICE", genero: "F" },
            { nombre: "Catalina", apellido: "Brieba", equipo: "AGF BICE", genero: "F" },
            { nombre: "Ruben", apellido: "Catalan", equipo: "AGF BICE", genero: "M" },
            { nombre: "Mauricio", apellido: "Fernandez", equipo: "AGF BICE", genero: "M" },
            { nombre: "Alex", apellido: "Fredes", equipo: "AGF BICE", genero: "M" },
            { nombre: "Marco", apellido: "Gallardo", equipo: "AGF BICE", genero: "M" },
            { nombre: "Tamara", apellido: "Gonzalez", equipo: "AGF BICE", genero: "F" },
            { nombre: "Martin", apellido: "Koppmann", equipo: "AGF BICE", genero: "M" },
            { nombre: "Sebasti√°n", apellido: "Kovacevic", equipo: "AGF BICE", genero: "M" },
            { nombre: "Pablo", apellido: "Lopez", equipo: "AGF BICE", genero: "M" },
            { nombre: "Darko", apellido: "Mardones", equipo: "AGF BICE", genero: "M" },
            { nombre: "Tamara", apellido: "Palomo", equipo: "AGF BICE", genero: "F" },
            { nombre: "Viviana", apellido: "Pe√±a", equipo: "AGF BICE", genero: "F" },
            { nombre: "Javier", apellido: "Ramirez", equipo: "AGF BICE", genero: "M" },
            { nombre: "Hector", apellido: "Reyes", equipo: "AGF BICE", genero: "M" },
            { nombre: "Daniel", apellido: "Valenzuela", equipo: "AGF BICE", genero: "M" },
            { nombre: "Javier", apellido: "Valenzuela", equipo: "AGF BICE", genero: "M" },
            { nombre: "Ignacio", apellido: "Vega", equipo: "AGF BICE", genero: "M" },
            { nombre: "Maximiliano", apellido: "Vera", equipo: "AGF BICE", genero: "M" },
            { nombre: "Mabel", apellido: "Weber", equipo: "AGF BICE", genero: "F" },
            { nombre: "Alejandro", apellido: "Zu√±iga", equipo: "AGF BICE", genero: "M" },
            // Estudios BICE
            { nombre: "Enzo", apellido: "Antilef", equipo: "Estudios BICE", genero: "M" },
            { nombre: "Mariela", apellido: "Bastias", equipo: "Estudios BICE", genero: "F" },
            { nombre: "Isidora", apellido: "Bazan", equipo: "Estudios BICE", genero: "F" },
            { nombre: "Marco", apellido: "Correa", equipo: "Estudios BICE", genero: "M" },
            { nombre: "Rodrigo", apellido: "Escudero", equipo: "Estudios BICE", genero: "M" },
            { nombre: "Rodrigo", apellido: "Garay", equipo: "Estudios BICE", genero: "M" },
            { nombre: "Jose", apellido: "Herrera", equipo: "Estudios BICE", genero: "M" },
            { nombre: "Diego", apellido: "Larach", equipo: "Estudios BICE", genero: "M" },
            { nombre: "Diego", apellido: "Pinochet", equipo: "Estudios BICE", genero: "M" },
            { nombre: "Marcelo", apellido: "Videla", equipo: "Estudios BICE", genero: "M" },
            { nombre: "Marco", apellido: "Zu√±iga", equipo: "Estudios BICE", genero: "M" },
            // Practicante BICE
            { nombre: "Benjamin", apellido: "Barrientos", equipo: "Practicante BICE", genero: "M" },
            { nombre: "Constanza", apellido: "Bola√±os", equipo: "Practicante BICE", genero: "F" },
            { nombre: "Joaquin", apellido: "Gonzalez", equipo: "Practicante BICE", genero: "M" },
            { nombre: "Daniel", apellido: "Mora", equipo: "Practicante BICE", genero: "M" },
            { nombre: "Christian", apellido: "Pino", equipo: "Practicante BICE", genero: "M" },
            { nombre: "Jose", apellido: "Sierra", equipo: "Practicante BICE", genero: "M" },
            // AGF Security
            { nombre: "Luca", apellido: "Appiani", equipo: "AGF Security", genero: "M" },
            { nombre: "Nicol√°s", apellido: "Arancibia", equipo: "AGF Security", genero: "M" },
            { nombre: "Ricardo", apellido: "Arratia", equipo: "AGF Security", genero: "M" },
            { nombre: "Francisco", apellido: "Arteaga", equipo: "AGF Security", genero: "M" },
            { nombre: "Felipe", apellido: "Asencio", equipo: "AGF Security", genero: "M" },
            { nombre: "Andr√©s", apellido: "Barahona", equipo: "AGF Security", genero: "M" },
            { nombre: "Pablo", apellido: "Bertoglia", equipo: "AGF Security", genero: "M" },
            { nombre: "Juan", apellido: "Castillo", equipo: "AGF Security", genero: "M" },
            { nombre: "Gabriela", apellido: "Chamorro", equipo: "AGF Security", genero: "F" },
            { nombre: "Alejandra", apellido: "Drulinsky", equipo: "AGF Security", genero: "F" },
            { nombre: "Fabiola", apellido: "Gonzalez", equipo: "AGF Security", genero: "F" },
            { nombre: "Ernesto", apellido: "Mardones", equipo: "AGF Security", genero: "M" },
            { nombre: "Guillermo", apellido: "Marin", equipo: "AGF Security", genero: "M" },
            { nombre: "Rommy", apellido: "Nawrath", equipo: "AGF Security", genero: "F" },
            { nombre: "Javier", apellido: "Reyes", equipo: "AGF Security", genero: "M" },
            { nombre: "Sebasti√°n", apellido: "Rodriguez", equipo: "AGF Security", genero: "M" },
            { nombre: "Joaquin", apellido: "Scheel", equipo: "AGF Security", genero: "M" },
            { nombre: "Francisca", apellido: "Silva", equipo: "AGF Security", genero: "F" },
            { nombre: "Francisco", apellido: "Valdes", equipo: "AGF Security", genero: "M" },
            { nombre: "Marcelo", apellido: "Velasquez", equipo: "AGF Security", genero: "M" },
            { nombre: "Stefania", apellido: "V√©liz", equipo: "AGF Security", genero: "F" },
            { nombre: "Rafael", apellido: "Videla", equipo: "AGF Security", genero: "M" },
            { nombre: "Lucas", apellido: "Villaseca", equipo: "AGF Security", genero: "M" },
            { nombre: "Jorge", apellido: "Meyer", equipo: "AGF Security", genero: "M" },
            // Estudios Security
            { nombre: "Paulina", apellido: "Barahona", equipo: "Estudios Security", genero: "F" },
            { nombre: "Marcela", apellido: "Calisto", equipo: "Estudios Security", genero: "F" },
            { nombre: "Felipe", apellido: "Jaque", equipo: "Estudios Security", genero: "M" },
            { nombre: "Nicolas", apellido: "Libuy", equipo: "Estudios Security", genero: "M" },
            { nombre: "Eduardo", apellido: "Salas", equipo: "Estudios Security", genero: "M" },
            { nombre: "Juan Ignacio", apellido: "Vicencio", equipo: "Estudios Security", genero: "M" }
        ];

        // Preguntas de la encuesta
        const questions = [
            { id: "cahuinero", title: "Premio Mas Cahuinero", subtitle: "Las mejores papitas de la AGF", type: "candidates", image: "üó£Ô∏è" },
            { id: "avepalta", title: "Premio Ave Palta", subtitle: "El mas bueno para comer", type: "candidates", image: "ü•ë" },
            { id: "superman", title: "Premio Superman", subtitle: "Mas macabeo", type: "candidates", image: "ü¶∏" },
            { id: "deportista", title: "Premio Deportista del A√±o", subtitle: "Mejor deportista 2024", type: "candidates", image: "üèÉ" },
            { id: "pollocastillo", title: "Premio Pollo Castillo", subtitle: "Mas chistoso", type: "candidates", image: "üòÇ" },
            { id: "postumo", title: "Premio P√≥stumo", subtitle: "Persona ex BICE que mas extra√±as", type: "open", image: "üí≠" },
            { id: "expositor", title: "Premio Mejor Expositor", subtitle: "Que mejor expone presentaciones", type: "candidates", image: "üé§" },
            { id: "alegria", title: "Premio Alegr√≠a", subtitle: "Mas alegre de la AGF", type: "candidates", image: "üòÑ" },
            { id: "gino", title: "Premio Gino Lorenzini", subtitle: "Mas timber@", type: "candidates", image: "‚è∞" },
            { id: "bielsa", title: "Premio Marcelo Bielsa", subtitle: "Mejor l√≠der del a√±o", type: "candidates", image: "üëî" },
            { id: "companero", title: "Premio Mejor Compa√±ero/a", subtitle: "El mejor compa√±er@ del a√±o", type: "candidates", image: "ü§ù" },
            { id: "revelacion", title: "Premio Revelaci√≥n", subtitle: "Premio revelaci√≥n del a√±o", type: "candidates", image: "‚≠ê" },
            { id: "mejorfondo", title: "Mejor Fondo", subtitle: "¬øCu√°l fue el mejor fondo del a√±o?", type: "open", image: "üíº" }
        ];

        // Estado de la encuesta
        let currentQuestion = 0;
        let surveyData = {
            personal: {},
            votes: {}
        };

        // Almacenamiento de votos (simula base de datos)
        let allVotes = JSON.parse(localStorage.getItem('biceVotes2025') || '[]');

        // Inicializar
        function initSurvey() {
            // Cargar votos guardados
            allVotes = JSON.parse(localStorage.getItem('biceVotes2025') || '[]');
        }

        // Cambiar de pesta√±a
        function switchTab(tabName) {
            document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
            
            event.target.classList.add('active');
            document.getElementById(tabName).classList.add('active');
        }

        // Comenzar encuesta
        function startSurvey() {
            const nombre = document.getElementById('nombre').value.trim();
            const apellido = document.getElementById('apellido').value.trim();
            const email = document.getElementById('email').value.trim();

            if (!nombre || !apellido || !email) {
                alert('Por favor completa todos los campos');
                return;
            }

            if (!email.includes('@')) {
                alert('Por favor ingresa un correo electr√≥nico v√°lido');
                return;
            }

            surveyData.personal = { nombre, apellido, email };
            document.getElementById('personalInfo').style.display = 'none';
            document.getElementById('surveyQuestions').style.display = 'block';
            
            generateQuestions();
            showQuestion(0);
        }

        // Estado de filtros activos por pregunta
        let activeFilters = {};
        let personalFilters = [];
        let selectedPersonalName = '';
        let selectedPersonalFirstName = '';
        let selectedPersonalLastName = '';

        // Filtros para selecci√≥n personal
        function togglePersonalFilter(filterValue, filterType) {
            const button = event.target;
            const filterKey = `${filterType}-${filterValue}`;
            
            if (button.classList.contains('active')) {
                button.classList.remove('active');
                personalFilters = personalFilters.filter(f => f.key !== filterKey);
            } else {
                button.classList.add('active');
                personalFilters.push({
                    key: filterKey,
                    type: filterType,
                    value: filterValue
                });
            }
            
            updatePersonalFiltersDisplay();
            applyPersonalFilters();
        }

        function updatePersonalFiltersDisplay() {
            const container = document.getElementById('personal-active-filters');
            if (!container) return;
            
            if (personalFilters.length === 0) {
                container.innerHTML = '<span style="color: #999;">Ning√∫n filtro activo</span>';
            } else {
                container.innerHTML = personalFilters.map(f => 
                    `<span style="display: inline-block; background: #2980b9; color: white; padding: 5px 10px; border-radius: 15px; margin: 2px;">${f.value}</span>`
                ).join('');
            }
        }

        function clearPersonalFilters() {
            personalFilters = [];
            const buttons = document.querySelectorAll('#personalInfo .filter-btn');
            buttons.forEach(btn => btn.classList.remove('active'));
            updatePersonalFiltersDisplay();
            applyPersonalFilters();
        }

        function applyPersonalFilters() {
            const cards = document.querySelectorAll('#personal-candidates .candidate-card');
            
            if (personalFilters.length === 0) {
                cards.forEach(card => card.style.display = 'block');
                return;
            }
            
            const genderFilters = personalFilters.filter(f => f.type === 'gender').map(f => f.value);
            const teamFilters = personalFilters.filter(f => f.type === 'team').map(f => f.value);
            
            cards.forEach(card => {
                const cardGender = card.dataset.gender;
                const cardTeam = card.dataset.team;
                
                let showCard = true;
                
                if (genderFilters.length > 0) {
                    showCard = showCard && genderFilters.includes(cardGender);
                }
                
                if (teamFilters.length > 0) {
                    showCard = showCard && teamFilters.includes(cardTeam);
                }
                
                card.style.display = showCard ? 'block' : 'none';
            });
        }

        function filterPersonalCandidates() {
            const searchBox = document.getElementById('personalSearch');
            const searchTerm = searchBox.value.toLowerCase();
            const cards = document.querySelectorAll('#personal-candidates .candidate-card');
            
            cards.forEach(card => {
                const name = card.dataset.name;
                const currentDisplay = card.style.display;
                
                if (name.includes(searchTerm)) {
                    // Solo mostrar si no est√° oculto por filtros
                    if (currentDisplay !== 'none' || personalFilters.length === 0) {
                        card.style.display = 'block';
                    }
                } else {
                    card.style.display = 'none';
                }
            });
            
            // Reaplicar filtros despu√©s de la b√∫squeda
            if (personalFilters.length > 0) {
                applyPersonalFilters();
            }
        }

        function selectPersonalInfo(fullName, nombre, apellido, element) {
            const container = element.parentElement;
            container.querySelectorAll('.candidate-card').forEach(card => {
                card.classList.remove('selected');
            });
            element.classList.add('selected');
            
            selectedPersonalName = fullName;
            selectedPersonalFirstName = nombre;
            selectedPersonalLastName = apellido;
            
            // Ocultar advertencia de duplicado si estaba visible
            document.getElementById('duplicateWarning').style.display = 'none';
        }

        // Verificar si el usuario ya vot√≥
        function checkDuplicateVote(email) {
            return allVotes.some(vote => vote.personal.email.toLowerCase() === email.toLowerCase());
        }

        // Comenzar encuesta
        function startSurvey() {
            const email = document.getElementById('email').value.trim();

            if (!selectedPersonalName) {
                alert('Por favor selecciona tu nombre de la lista');
                return;
            }

            if (!email) {
                alert('Por favor ingresa tu correo electr√≥nico');
                return;
            }

            if (!email.includes('@')) {
                alert('Por favor ingresa un correo electr√≥nico v√°lido');
                return;
            }

            // Verificar si ya vot√≥
            if (checkDuplicateVote(email)) {
                document.getElementById('duplicateWarning').style.display = 'block';
                alert('Ya existe una respuesta registrada con este correo electr√≥nico. No puedes votar nuevamente.');
                return;
            }

            surveyData.personal = { 
                nombre: selectedPersonalFirstName, 
                apellido: selectedPersonalLastName, 
                email, 
                fullName: selectedPersonalName 
            };
            document.getElementById('personalInfo').style.display = 'none';
            document.getElementById('surveyQuestions').style.display = 'block';
            
            generateQuestions();
            showQuestion(0);
        }
        
        // Inicializar
        function initSurvey() {
            // Cargar votos guardados
            allVotes = JSON.parse(localStorage.getItem('biceVotes2025') || '[]');
            // Cargar candidatos en la secci√≥n personal
            loadPersonalCandidates();
            // Inicializar display de filtros
            updatePersonalFiltersDisplay();
        }

        // Cargar candidatos en la secci√≥n de informaci√≥n personal
        function loadPersonalCandidates() {
            const container = document.getElementById('personal-candidates');
            if (!container) return;
            
            // Ordenar candidatos alfab√©ticamente por nombre
            const sortedCandidates = [...candidates].sort((a, b) => 
                a.nombre.localeCompare(b.nombre)
            );
            
            container.innerHTML = sortedCandidates.map(candidate => {
                const genderClass = candidate.genero === 'M' ? 'male' : 'female';
                const genderIcon = candidate.genero === 'M' ? 'üë®' : 'üë©';
                const fullName = `${candidate.nombre} ${candidate.apellido}`;
                
                return `
                    <div class="candidate-card" 
                         data-name="${fullName.toLowerCase()}"
                         data-team="${candidate.equipo}"
                         data-gender="${candidate.genero}"
                         onclick="selectPersonalInfo('${fullName.replace(/'/g, "\\'")}', '${candidate.nombre.replace(/'/g, "\\'")}', '${candidate.apellido.replace(/'/g, "\\'")}', this)">
                        <div class="candidate-name">
                            ${candidate.nombre} ${candidate.apellido}
                            <span class="gender-badge gender-${genderClass}">
                                ${genderIcon}
                            </span>
                        </div>
                        <div class="candidate-team">${candidate.equipo}</div>
                    </div>
                `;
            }).join('');
        }

        // Cambiar de pesta√±a
        function switchTab(tabName) {
            document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
            
            event.target.classList.add('active');
            document.getElementById(tabName).classList.add('active');
        }

        function generateQuestions() {
            const container = document.getElementById('surveyQuestions');
            
            // Agregar preguntas
            questions.forEach((q, index) => {
                // Inicializar filtros para esta pregunta
                activeFilters[index] = [];
                
                const questionDiv = document.createElement('div');
                questionDiv.className = 'question-container';
                questionDiv.id = `question-${index}`;
                
                if (q.type === 'open') {
                    // Pregunta abierta
                    questionDiv.innerHTML = `
                        <h2 class="question-title">${q.image} ${q.title}<br><small style="font-size: 0.7em; color: #666;">${q.subtitle}</small></h2>
                        
                        <div class="form-group">
                            <label for="open-${index}">Tu respuesta:</label>
                            <input type="text" id="open-${index}" class="search-box" placeholder="Escribe tu respuesta aqu√≠..." style="padding: 20px; font-size: 1.1em;">
                        </div>
                        
                        <div class="navigation">
                            <button class="btn btn-secondary" onclick="previousQuestion()" ${index === 0 ? 'style="visibility: hidden;"' : ''}>‚Üê Anterior</button>
                            <button class="btn btn-primary" onclick="nextQuestion()" id="nextBtn-${index}">Siguiente ‚Üí</button>
                        </div>
                    `;
                } else {
                    // Pregunta con candidatos
                    questionDiv.innerHTML = `
                        <h2 class="question-title">${q.image} ${q.title}<br><small style="font-size: 0.7em; color: #666;">${q.subtitle}</small></h2>
                        
                        <input type="text" class="search-box" placeholder="üîç Buscar por nombre..." onkeyup="filterCandidates(${index})">
                        
                        <div style="margin-bottom: 15px;">
                            <strong>Filtros activos:</strong>
                            <button class="btn btn-secondary" style="padding: 5px 15px; margin-left: 10px;" onclick="clearFilters(${index})">Limpiar filtros</button>
                            <div id="active-filters-${index}" style="margin-top: 10px; min-height: 20px;"></div>
                        </div>
                        
                        <div class="filters">
                            <button class="filter-btn" data-filter="M" onclick="toggleFilter(${index}, 'M', 'gender')">üë® Hombres</button>
                            <button class="filter-btn" data-filter="F" onclick="toggleFilter(${index}, 'F', 'gender')">üë© Mujeres</button>
                            <button class="filter-btn" data-filter="AGF BICE" onclick="toggleFilter(${index}, 'AGF BICE', 'team')">AGF BICE</button>
                            <button class="filter-btn" data-filter="AGF Security" onclick="toggleFilter(${index}, 'AGF Security', 'team')">AGF Security</button>
                            <button class="filter-btn" data-filter="Estudios BICE" onclick="toggleFilter(${index}, 'Estudios BICE', 'team')">Estudios BICE</button>
                            <button class="filter-btn" data-filter="Estudios Security" onclick="toggleFilter(${index}, 'Estudios Security', 'team')">Estudios Security</button>
                            <button class="filter-btn" data-filter="Practicante BICE" onclick="toggleFilter(${index}, 'Practicante BICE', 'team')">Practicante BICE</button>
                        </div>
                        
                        <div class="candidates-grid" id="candidates-${index}">
                            ${generateCandidateCards(index)}
                        </div>
                        
                        <div class="navigation">
                            <button class="btn btn-secondary" onclick="previousQuestion()" ${index === 0 ? 'style="visibility: hidden;"' : ''}>‚Üê Anterior</button>
                            <button class="btn btn-primary" onclick="nextQuestion()" id="nextBtn-${index}">Siguiente ‚Üí</button>
                        </div>
                    `;
                }
                
                container.appendChild(questionDiv);
            });
        }

        // Toggle filtro (permite m√∫ltiples filtros)
        function toggleFilter(questionIndex, filterValue, filterType) {
            const button = event.target;
            const filterKey = `${filterType}-${filterValue}`;
            
            if (button.classList.contains('active')) {
                // Remover filtro
                button.classList.remove('active');
                activeFilters[questionIndex] = activeFilters[questionIndex].filter(f => f.key !== filterKey);
            } else {
                // Agregar filtro
                button.classList.add('active');
                activeFilters[questionIndex].push({
                    key: filterKey,
                    type: filterType,
                    value: filterValue
                });
            }
            
            updateActiveFiltersDisplay(questionIndex);
            applyFilters(questionIndex);
        }

        // Actualizar display de filtros activos
        function updateActiveFiltersDisplay(questionIndex) {
            const container = document.getElementById(`active-filters-${questionIndex}`);
            if (!container) return;
            
            if (activeFilters[questionIndex].length === 0) {
                container.innerHTML = '<span style="color: #999;">Ning√∫n filtro activo</span>';
            } else {
                container.innerHTML = activeFilters[questionIndex].map(f => 
                    `<span style="display: inline-block; background: #2980b9; color: white; padding: 5px 10px; border-radius: 15px; margin: 2px;">${f.value}</span>`
                ).join('');
            }
        }

        // Limpiar todos los filtros
        function clearFilters(questionIndex) {
            activeFilters[questionIndex] = [];
            const buttons = document.querySelectorAll(`#question-${questionIndex} .filter-btn`);
            buttons.forEach(btn => btn.classList.remove('active'));
            updateActiveFiltersDisplay(questionIndex);
            applyFilters(questionIndex);
        }

        // Aplicar filtros m√∫ltiples
        function applyFilters(questionIndex) {
            const cards = document.querySelectorAll(`#candidates-${questionIndex} .candidate-card`);
            
            if (activeFilters[questionIndex].length === 0) {
                // Sin filtros, mostrar todos
                cards.forEach(card => card.style.display = 'block');
                return;
            }
            
            // Separar filtros por tipo
            const genderFilters = activeFilters[questionIndex]
                .filter(f => f.type === 'gender')
                .map(f => f.value);
            const teamFilters = activeFilters[questionIndex]
                .filter(f => f.type === 'team')
                .map(f => f.value);
            
            cards.forEach(card => {
                const cardGender = card.dataset.gender;
                const cardTeam = card.dataset.team;
                
                let showCard = true;
                
                // Si hay filtros de g√©nero, el candidato debe coincidir
                if (genderFilters.length > 0) {
                    showCard = showCard && genderFilters.includes(cardGender);
                }
                
                // Si hay filtros de equipo, el candidato debe coincidir
                if (teamFilters.length > 0) {
                    showCard = showCard && teamFilters.includes(cardTeam);
                }
                
                card.style.display = showCard ? 'block' : 'none';
            });
        }

        // Generar tarjetas de candidatos
        function generateCandidateCards(questionIndex) {
            const sortedCandidates = [...candidates].sort((a, b) => 
                a.nombre.localeCompare(b.nombre)
            );
            
            return sortedCandidates.map((candidate, i) => {
                const fullName = `${candidate.nombre} ${candidate.apellido}`;
                return `
                <div class="candidate-card" 
                     data-name="${fullName.toLowerCase()}"
                     data-team="${candidate.equipo}"
                     data-gender="${candidate.genero}"
                     onclick="selectCandidate(${questionIndex}, '${fullName.replace(/'/g, "\\'")}', this)">
                    <div class="candidate-name">
                        ${fullName}
                        <span class="gender-badge gender-${candidate.genero === 'M' ? 'male' : 'female'}">
                            ${candidate.genero === 'M' ? 'üë®' : 'üë©'}
                        </span>
                    </div>
                    <div class="candidate-team">${candidate.equipo}</div>
                </div>
            `}).join('');
        }

        // Seleccionar candidato
        function selectCandidate(questionIndex, candidateName, element) {
            const container = element.parentElement;
            container.querySelectorAll('.candidate-card').forEach(card => {
                card.classList.remove('selected');
            });
            element.classList.add('selected');
            
            surveyData.votes[questions[questionIndex].id] = candidateName;
        }

        // Filtrar por b√∫squeda
        function filterCandidates(questionIndex) {
            const searchBox = document.querySelector(`#question-${questionIndex} .search-box`);
            const searchTerm = searchBox.value.toLowerCase();
            const cards = document.querySelectorAll(`#candidates-${questionIndex} .candidate-card`);
            
            cards.forEach(card => {
                const name = card.dataset.name;
                if (name.includes(searchTerm)) {
                    card.style.display = 'block';
                } else {
                    card.style.display = 'none';
                }
            });
        }

        // Siguiente pregunta
        function nextQuestion() {
            const currentQ = questions[currentQuestion];
            
            if (currentQ.type === 'open') {
                const input = document.getElementById(`open-${currentQuestion}`);
                const value = input.value.trim();
                if (!value) {
                    alert('Por favor escribe una respuesta antes de continuar');
                    return;
                }
                surveyData.votes[currentQ.id] = value;
            } else {
                if (!surveyData.votes[currentQ.id]) {
                    alert('Por favor selecciona una opci√≥n antes de continuar');
                    return;
                }
            }
            
            if (currentQuestion < questions.length - 1) {
                showQuestion(currentQuestion + 1);
            } else {
                submitSurvey();
            }
        }

        // Enviar encuesta
        function submitSurvey() {
            // Verificar √∫ltima pregunta
            const lastQ = questions[questions.length - 1];
            if (lastQ.type === 'open') {
                const input = document.getElementById(`open-${questions.length - 1}`);
                const value = input.value.trim();
                if (!value) {
                    alert('Por favor completa la √∫ltima pregunta antes de enviar');
                    return;
                }
                surveyData.votes[lastQ.id] = value;
            }
            
            // Agregar timestamp
            surveyData.timestamp = new Date().toISOString();
            
            // Guardar voto
            allVotes.push(surveyData);
            localStorage.setItem('biceVotes2025', JSON.stringify(allVotes));
            
            // Mostrar mensaje de √©xito
            document.getElementById('successMessage').classList.add('show');
            document.getElementById('surveyQuestions').style.display = 'none';
            
            // Reiniciar despu√©s de 3 segundos
            setTimeout(() => {
                location.reload();
            }, 3000);
        }

        // Actualizar barra de progreso
        function updateProgress() {
            const totalQuestions = questions.length;
            const progress = ((currentQuestion + 1) / totalQuestions) * 100;
            document.getElementById('progressFill').style.width = progress + '%';
        }

        // Admin: Verificar contrase√±a
        function checkAdminPassword() {
            const password = document.getElementById('adminPassword').value;
            if (password === 'Premios2025') {
                document.getElementById('adminLogin').style.display = 'none';
                document.getElementById('adminDashboard').classList.add('active');
                loadAdminDashboard();
            } else {
                alert('Contrase√±a incorrecta');
            }
        }

        // Mostrar pregunta
        function showQuestion(index) {
            document.querySelectorAll('.question-container').forEach(q => {
                q.classList.remove('active');
            });
            
            const question = document.getElementById(`question-${index}`);
            if (question) {
                question.classList.add('active');
                currentQuestion = index;
                updateProgress();
            }
        }

        // Pregunta anterior
        function previousQuestion() {
            showQuestion(currentQuestion - 1);
        }

        // Admin: Cargar dashboard
        function loadAdminDashboard() {
            const container = document.getElementById('statsContainer');
            container.innerHTML = '';
            
            if (allVotes.length === 0) {
                container.innerHTML = '<div class="stat-card"><p style="text-align: center; color: #666;">No hay votos registrados a√∫n.</p></div>';
                return;
            }
            
            // Agregar resumen estad√≠stico
            const totalVotes = allVotes.length;
            const uniqueVoters = new Set(allVotes.map(v => v.personal.email)).size;
            const completionRate = ((uniqueVoters / totalVotes) * 100).toFixed(1);
            
            const summaryHTML = `
                <div style="grid-column: 1 / -1;">
                    <div class="stats-summary">
                        <div class="summary-card">
                            <div class="summary-number">${totalVotes}</div>
                            <div class="summary-label">Total de Votos</div>
                        </div>
                        <div class="summary-card" style="background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);">
                            <div class="summary-number">${uniqueVoters}</div>
                            <div class="summary-label">Votantes √önicos</div>
                        </div>
                        <div class="summary-card" style="background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);">
                            <div class="summary-number">${questions.length}</div>
                            <div class="summary-label">Premios</div>
                        </div>
                        <div class="summary-card" style="background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%);">
                            <div class="summary-number">${completionRate}%</div>
                            <div class="summary-label">Participaci√≥n</div>
                        </div>
                    </div>
                </div>
            `;
            
            container.innerHTML = summaryHTML;
            
            // Calcular resultados para cada pregunta
            questions.forEach(question => {
                const votes = {};
                const voteDetails = [];
                
                allVotes.forEach(vote => {
                    const answer = vote.votes[question.id];
                    if (answer) {
                        votes[answer] = (votes[answer] || 0) + 1;
                        voteDetails.push({
                            voter: `${vote.personal.nombre} ${vote.personal.apellido}`,
                            email: vote.personal.email,
                            vote: answer
                        });
                    }
                });
                
                // Ordenar por n√∫mero de votos
                const sortedVotes = Object.entries(votes).sort((a, b) => b[1] - a[1]);
                const winner = sortedVotes.length > 0 ? sortedVotes[0] : null;
                const totalVotesForQuestion = sortedVotes.reduce((sum, [, count]) => sum + count, 0);
                
                const statCard = document.createElement('div');
                statCard.className = 'stat-card';
                statCard.innerHTML = `
                    <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 15px;">
                        <h3>${question.image} ${question.title}</h3>
                        <button class="btn btn-secondary" style="padding: 5px 15px;" onclick="showVoteDetails('${question.id}')">üìä Ver Detalles</button>
                    </div>
                    
                    <div style="background: #f8f9fa; padding: 10px; border-radius: 5px; margin-bottom: 15px;">
                        <strong>Total de votos:</strong> ${totalVotesForQuestion}
                    </div>
                    
                    ${winner ? `
                        <div style="background: linear-gradient(135deg, #FFD700 0%, #FFA500 100%); padding: 20px; border-radius: 10px; margin: 15px 0; text-align: center;">
                            <div style="font-size: 3em; margin-bottom: 10px;">üèÜ</div>
                            <div style="font-size: 1.5em; font-weight: bold; color: #2c3e50;">${winner[0]}</div>
                            <div style="font-size: 1.2em; color: #555; margin-top: 5px;">${winner[1]} votos (${((winner[1] / totalVotesForQuestion) * 100).toFixed(1)}%)</div>
                        </div>
                    ` : ''}
                    
                    <div style="margin-top: 20px;">
                        <strong>Top 3:</strong>
                        ${sortedVotes.slice(0, 3).map(([name, count], index) => {
                            const colors = ['#FFD700', '#C0C0C0', '#CD7F32'];
                            const medals = ['ü•á', 'ü•à', 'ü•â'];
                            const percentage = ((count / totalVotesForQuestion) * 100).toFixed(1);
                            return `
                                <div class="result-item" style="background: ${colors[index]}22; border-left: 4px solid ${colors[index]};">
                                    <span class="result-name">${medals[index]} ${name}</span>
                                    <span class="result-votes">${count} votos (${percentage}%)</span>
                                </div>
                            `;
                        }).join('')}
                    </div>
                    
                    ${sortedVotes.length > 3 ? `
                        <div style="margin-top: 15px;">
                            <button class="btn btn-secondary" style="padding: 8px 15px; width: 100%;" onclick="showAllResults('${question.id}')">Ver todos los resultados (${sortedVotes.length})</button>
                        </div>
                    ` : ''}
                    
                    ${sortedVotes.length === 0 ? '<p style="color: #666; text-align: center;">Sin votos a√∫n</p>' : ''}
                `;
                
                // Guardar detalles de votos en un atributo de datos
                statCard.dataset.voteDetails = JSON.stringify(voteDetails);
                statCard.dataset.questionId = question.id;
                statCard.dataset.allResults = JSON.stringify(sortedVotes);
                
                container.appendChild(statCard);
            });
        }

        // Mostrar detalles de votos
        function showVoteDetails(questionId) {
            const card = document.querySelector(`[data-question-id="${questionId}"]`);
            const details = JSON.parse(card.dataset.voteDetails || '[]');
            
            const modal = document.createElement('div');
            modal.className = 'modal-overlay';
            
            const content = document.createElement('div');
            content.className = 'modal-content';
            
            const question = questions.find(q => q.id === questionId);
            
            content.innerHTML = `
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                    <h2>${question.image} ${question.title}</h2>
                    <button class="btn btn-secondary" onclick="this.closest('.modal-overlay').remove()">‚úï Cerrar</button>
                </div>
                
                <div style="margin-bottom: 20px;">
                    <strong>Total de votos: ${details.length}</strong>
                </div>
                
                <div style="overflow-x: auto;">
                    <table>
                        <thead>
                            <tr>
                                <th>Votante</th>
                                <th>Email</th>
                                <th>Voto</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${details.map(d => `
                                <tr>
                                    <td>${d.voter}</td>
                                    <td>${d.email}</td>
                                    <td><strong>${d.vote}</strong></td>
                                </tr>
                            `).join('')}
                        </tbody>
                    </table>
                </div>
            `;
            
            modal.appendChild(content);
            document.body.appendChild(modal);
            
            // Cerrar al hacer clic fuera del contenido
            modal.addEventListener('click', (e) => {
                if (e.target === modal) {
                    modal.remove();
                }
            });
        }

        // Mostrar todos los resultados
        function showAllResults(questionId) {
            const card = document.querySelector(`[data-question-id="${questionId}"]`);
            const allResults = JSON.parse(card.dataset.allResults || '[]');
            
            const modal = document.createElement('div');
            modal.className = 'modal-overlay';
            
            const content = document.createElement('div');
            content.className = 'modal-content';
            
            const question = questions.find(q => q.id === questionId);
            const totalVotes = allResults.reduce((sum, [, count]) => sum + count, 0);
            
            content.innerHTML = `
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                    <h2>${question.image} Resultados Completos - ${question.title}</h2>
                    <button class="btn btn-secondary" onclick="this.closest('.modal-overlay').remove()">‚úï Cerrar</button>
                </div>
                
                <div style="margin-bottom: 20px;">
                    <strong>Total de votos: ${totalVotes}</strong>
                </div>
                
                <div class="bar-chart">
                    ${allResults.map(([name, count], index) => {
                        const percentage = ((count / totalVotes) * 100).toFixed(1);
                        const medals = ['ü•á', 'ü•à', 'ü•â'];
                        const medal = index < 3 ? medals[index] : `${index + 1}.`;
                        
                        return `
                            <div class="bar-item">
                                <div class="bar-label">${medal} ${name}</div>
                                <div class="bar-fill-container">
                                    <div class="bar-fill" style="width: ${percentage}%;">
                                        ${count} votos
                                    </div>
                                </div>
                                <div style="min-width: 60px; text-align: right; font-weight: 600; color: #2980b9;">
                                    ${percentage}%
                                </div>
                            </div>
                        `;
                    }).join('')}
                </div>
            `;
            
            modal.appendChild(content);
            document.body.appendChild(modal);
            
            // Cerrar al hacer clic fuera del contenido
            modal.addEventListener('click', (e) => {
                if (e.target === modal) {
                    modal.remove();
                }
            });
        }

        // Admin: Exportar a Excel
        function exportToExcel() {
            if (allVotes.length === 0) {
                alert('No hay votos para exportar');
                return;
            }
            
            // Crear CSV con todos los votos
            let csv = 'Nombre,Apellido,Email,Fecha/Hora,';
            questions.forEach(q => {
                csv += `"${q.title}",`;
            });
            csv += '\n';
            
            allVotes.forEach(vote => {
                csv += `"${vote.personal.nombre}","${vote.personal.apellido}","${vote.personal.email}","${new Date(vote.timestamp).toLocaleString('es-CL')}",`;
                questions.forEach(q => {
                    csv += `"${vote.votes[q.id] || ''}",`;
                });
                csv += '\n';
            });
            
            // Agregar resumen de resultados
            csv += '\n\n=== RESUMEN DE RESULTADOS ===\n\n';
            
            questions.forEach(question => {
                csv += `\n"${question.title}"\n`;
                csv += 'Candidato,Votos\n';
                
                const votes = {};
                allVotes.forEach(vote => {
                    const answer = vote.votes[question.id];
                    if (answer) {
                        votes[answer] = (votes[answer] || 0) + 1;
                    }
                });
                
                const sortedVotes = Object.entries(votes).sort((a, b) => b[1] - a[1]);
                sortedVotes.forEach(([name, count]) => {
                    csv += `"${name}",${count}\n`;
                });
            });
            
            // Crear archivo CSV con BOM para Excel
            const BOM = '\uFEFF';
            const blob = new Blob([BOM + csv], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = `premios_bice_2025_${new Date().toISOString().split('T')[0]}.csv`;
            link.click();
        }

        // Admin: Generar PDF
        function generatePDF() {
            if (allVotes.length === 0) {
                alert('No hay votos para generar el PDF');
                return;
            }
            
            // Calcular ganadores
            const winners = {};
            
            questions.forEach(question => {
                const votes = {};
                allVotes.forEach(vote => {
                    const answer = vote.votes[question.id];
                    if (answer) {
                        votes[answer] = (votes[answer] || 0) + 1;
                    }
                });
                
                const sortedVotes = Object.entries(votes).sort((a, b) => b[1] - a[1]);
                if (sortedVotes.length > 0) {
                    winners[question.id] = {
                        title: question.title,
                        subtitle: question.subtitle,
                        image: question.image,
                        winner: sortedVotes[0][0],
                        votes: sortedVotes[0][1],
                        topThree: sortedVotes.slice(0, 3)
                    };
                }
            });
            
            // Crear contenido HTML para el PDF
            let pdfContent = `
                <!DOCTYPE html>
                <html>
                <head>
                    <meta charset="UTF-8">
                    <style>
                        @page { 
                            size: A4; 
                            margin: 0; 
                        }
                        body { 
                            font-family: 'Segoe UI', Arial, sans-serif; 
                            margin: 0;
                            padding: 0;
                        }
                        .page {
                            width: 210mm;
                            height: 297mm;
                            padding: 40px;
                            page-break-after: always;
                            position: relative;
                            background: linear-gradient(135deg, #1e5a8e 0%, #2980b9 100%);
                            display: flex;
                            flex-direction: column;
                            justify-content: center;
                            align-items: center;
                            color: white;
                        }
                        .page:last-child {
                            page-break-after: auto;
                        }
                        .cover-page {
                            text-align: center;
                        }
                        .cover-page h1 {
                            font-size: 4em;
                            margin-bottom: 20px;
                        }
                        .cover-page .emoji {
                            font-size: 6em;
                            margin: 30px 0;
                        }
                        .cover-page p {
                            font-size: 1.5em;
                            opacity: 0.9;
                        }
                        .award-page {
                            background: white;
                            color: #2c3e50;
                        }
                        .award-header {
                            text-align: center;
                            margin-bottom: 40px;
                        }
                        .award-emoji {
                            font-size: 5em;
                            margin-bottom: 20px;
                        }
                        .award-title {
                            font-size: 2.5em;
                            color: #2980b9;
                            margin-bottom: 10px;
                            font-weight: bold;
                        }
                        .award-subtitle {
                            font-size: 1.3em;
                            color: #666;
                            font-style: italic;
                        }
                        .winner-section {
                            background: linear-gradient(135deg, #FFD700 0%, #FFA500 100%);
                            padding: 50px;
                            border-radius: 20px;
                            text-align: center;
                            margin: 40px 0;
                            box-shadow: 0 10px 40px rgba(0,0,0,0.2);
                        }
                        .winner-label {
                            font-size: 1.5em;
                            color: #2c3e50;
                            margin-bottom: 20px;
                            font-weight: 600;
                        }
                        .winner-name {
                            font-size: 3em;
                            color: #2c3e50;
                            font-weight: bold;
                            margin: 20px 0;
                        }
                        .winner-votes {
                            font-size: 1.5em;
                            color: #555;
                        }
                        .podium {
                            display: flex;
                            justify-content: center;
                            gap: 20px;
                            margin-top: 40px;
                        }
                        .podium-place {
                            flex: 1;
                            text-align: center;
                            padding: 20px;
                            border-radius: 10px;
                            background: #f8f9fa;
                        }
                        .podium-medal {
                            font-size: 3em;
                            margin-bottom: 10px;
                        }
                        .podium-name {
                            font-size: 1.2em;
                            font-weight: 600;
                            color: #2c3e50;
                            margin-bottom: 5px;
                        }
                        .podium-votes {
                            font-size: 1em;
                            color: #2980b9;
                            font-weight: bold;
                        }
                        .footer {
                            text-align: center;
                            margin-top: 40px;
                            padding-top: 20px;
                            border-top: 2px solid #dee2e6;
                            color: #666;
                        }
                    </style>
                </head>
                <body>
                    <!-- Portada -->
                    <div class="page cover-page">
                        <div class="emoji">üèÜ</div>
                        <h1>PREMIOS BICE 2025</h1>
                        <p>Resultados Oficiales</p>
                        <p style="margin-top: 50px;">Santiago, ${new Date().toLocaleDateString('es-CL', { 
                            day: 'numeric', 
                            month: 'long', 
                            year: 'numeric' 
                        })}</p>
                        <p style="margin-top: 30px; font-size: 1.2em;">Total de participantes: ${allVotes.length}</p>
                    </div>
            `;
            
            // Agregar p√°gina por cada premio
            Object.values(winners).forEach(award => {
                pdfContent += `
                    <div class="page award-page">
                        <div class="award-header">
                            <div class="award-emoji">${award.image}</div>
                            <div class="award-title">${award.title}</div>
                            <div class="award-subtitle">${award.subtitle}</div>
                        </div>
                        
                        <div class="winner-section">
                            <div class="winner-label">GANADOR</div>
                            <div class="winner-name">${award.winner}</div>
                            <div class="winner-votes">${award.votes} votos</div>
                        </div>
                        
                        ${award.topThree.length > 1 ? `
                            <div class="podium">
                                ${award.topThree.map((place, index) => {
                                    const medals = ['ü•á', 'ü•à', 'ü•â'];
                                    const positions = ['1¬∞', '2¬∞', '3¬∞'];
                                    return `
                                        <div class="podium-place">
                                            <div class="podium-medal">${medals[index]}</div>
                                            <div class="podium-name">${place[0]}</div>
                                            <div class="podium-votes">${place[1]} votos</div>
                                        </div>
                                    `;
                                }).join('')}
                            </div>
                        ` : ''}
                        
                        <div class="footer">
                            <strong>BICE</strong> ‚Ä¢ Premios 2025
                        </div>
                    </div>
                `;
            });
            
            pdfContent += `
                </body>
                </html>
            `;
            
            // Crear y descargar PDF
            const newWindow = window.open('', '_blank');
            newWindow.document.write(pdfContent);
            newWindow.document.close();
            
            // Dar tiempo para que se renderice antes de imprimir
            setTimeout(() => {
                newWindow.print();
            }, 500);
        }

        // Admin: Cerrar sesi√≥n
        function logout() {
            document.getElementById('adminLogin').style.display = 'block';
            document.getElementById('adminDashboard').classList.remove('active');
            document.getElementById('adminPassword').value = '';
        }

        // Admin: Gestionar respuestas (ver y eliminar)
        function manageResponses() {
            if (allVotes.length === 0) {
                alert('No hay respuestas registradas para gestionar');
                return;
            }

            const modal = document.createElement('div');
            modal.className = 'modal-overlay';
            
            const content = document.createElement('div');
            content.className = 'modal-content';
            content.style.maxWidth = '1000px';
            
            content.innerHTML = `
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                    <h2>üóëÔ∏è Gestionar Respuestas</h2>
                    <button class="btn btn-secondary" onclick="this.closest('.modal-overlay').remove()">‚úï Cerrar</button>
                </div>
                
                <div style="margin-bottom: 20px; padding: 15px; background: #fff3cd; border-radius: 10px;">
                    <strong>‚ö†Ô∏è Advertencia:</strong> Al eliminar una respuesta, se borrar√°n permanentemente todos los votos de esa persona. Esta acci√≥n no se puede deshacer.
                </div>
                
                <div style="margin-bottom: 20px;">
                    <input type="text" id="searchResponses" class="search-box" placeholder="üîç Buscar por nombre o email..." onkeyup="filterResponsesTable()">
                </div>
                
                <div style="margin-bottom: 15px;">
                    <strong>Total de respuestas: ${allVotes.length}</strong>
                </div>
                
                <div style="overflow-x: auto;">
                    <table id="responsesTable">
                        <thead>
                            <tr>
                                <th>Nombre Completo</th>
                                <th>Email</th>
                                <th>Fecha</th>
                                <th style="text-align: center;">Acciones</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${allVotes.map((vote, index) => `
                                <tr data-search="${vote.personal.fullName || `${vote.personal.nombre} ${vote.personal.apellido}`} ${vote.personal.email}".toLowerCase()>
                                    <td><strong>${vote.personal.fullName || `${vote.personal.nombre} ${vote.personal.apellido}`}</strong></td>
                                    <td>${vote.personal.email}</td>
                                    <td>${new Date(vote.timestamp).toLocaleString('es-CL')}</td>
                                    <td style="text-align: center;">
                                        <button class="btn btn-secondary" style="padding: 5px 15px; background: #e74c3c;" onclick="deleteResponse(${index})">
                                            üóëÔ∏è Eliminar
                                        </button>
                                    </td>
                                </tr>
                            `).join('')}
                        </tbody>
                    </table>
                </div>
            `;
            
            modal.appendChild(content);
            document.body.appendChild(modal);
            
            // Cerrar al hacer clic fuera
            modal.addEventListener('click', (e) => {
                if (e.target === modal) {
                    modal.remove();
                }
            });
        }

        // Filtrar tabla de respuestas
        function filterResponsesTable() {
            const searchBox = document.getElementById('searchResponses');
            const searchTerm = searchBox.value.toLowerCase();
            const rows = document.querySelectorAll('#responsesTable tbody tr');
            
            rows.forEach(row => {
                const searchData = row.dataset.search;
                if (searchData.includes(searchTerm)) {
                    row.style.display = '';
                } else {
                    row.style.display = 'none';
                }
            });
        }

        // Eliminar una respuesta espec√≠fica
        function deleteResponse(index) {
            const vote = allVotes[index];
            const voterName = vote.personal.fullName || `${vote.personal.nombre} ${vote.personal.apellido}`;
            
            if (confirm(`¬øEst√°s seguro de que deseas eliminar la respuesta de ${voterName}?\n\nEsta acci√≥n no se puede deshacer.`)) {
                // Eliminar del array
                allVotes.splice(index, 1);
                
                // Guardar en localStorage
                localStorage.setItem('biceVotes2025', JSON.stringify(allVotes));
                
                // Cerrar modal
                document.querySelector('.modal-overlay').remove();
                
                // Recargar dashboard
                loadAdminDashboard();
                
                alert(`‚úì La respuesta de ${voterName} ha sido eliminada exitosamente.`);
            }
        }

        // Inicializar al cargar
        window.onload = initSurvey;
    </script>
</body>
</html>
